import React from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line } from 'recharts';
import Icon from '../../../components/AppIcon';

const VulnerabilityMetrics = () => {
  const severityData = [
    { name: 'Critical', count: 23, color: '#DC2626' },
    { name: 'High', count: 87, color: '#D97706' },
    { name: 'Medium', count: 156, color: '#0EA5E9' },
    { name: 'Low', count: 234, color: '#059669' }
  ];

  const trendData = [
    { month: 'Jan', discovered: 45, remediated: 38 },
    { month: 'Feb', discovered: 52, remediated: 41 },
    { month: 'Mar', discovered: 48, remediated: 45 },
    { month: 'Apr', discovered: 61, remediated: 52 },
    { month: 'May', discovered: 58, remediated: 55 },
    { month: 'Jun', discovered: 67, remediated: 59 }
  ];

  const assetTypeData = [
    { name: 'Web Applications', count: 187 },
    { name: 'Network Infrastructure', count: 143 },
    { name: 'Operating Systems', count: 98 },
    { name: 'Databases', count: 72 }
  ];

  const totalVulnerabilities = severityData?.reduce((sum, item) => sum + item?.count, 0);
  const criticalHighCount = severityData?.filter(item => ['Critical', 'High']?.includes(item?.name))?.reduce((sum, item) => sum + item?.count, 0);

  return (
    <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
      {/* Summary Cards */}
      <div className="bg-card rounded-lg p-6 security-shadow">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm text-muted-foreground">Total Vulnerabilities</p>
            <p className="text-3xl font-bold text-card-foreground">{totalVulnerabilities}</p>
            <p className="text-sm text-success mt-1">
              <Icon name="TrendingDown" size={16} className="inline mr-1" />
              -12% from last month
            </p>
          </div>
          <div className="w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center">
            <Icon name="Shield" size={24} className="text-accent" />
          </div>
        </div>
      </div>

      <div className="bg-card rounded-lg p-6 security-shadow">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm text-muted-foreground">Critical & High</p>
            <p className="text-3xl font-bold text-error">{criticalHighCount}</p>
            <p className="text-sm text-warning mt-1">
              <Icon name="TrendingUp" size={16} className="inline mr-1" />
              +5% from last month
            </p>
          </div>
          <div className="w-12 h-12 bg-error/10 rounded-lg flex items-center justify-center">
            <Icon name="AlertTriangle" size={24} className="text-error" />
          </div>
        </div>
      </div>

      <div className="bg-card rounded-lg p-6 security-shadow">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm text-muted-foreground">Remediated This Month</p>
            <p className="text-3xl font-bold text-success">59</p>
            <p className="text-sm text-success mt-1">
              <Icon name="CheckCircle" size={16} className="inline mr-1" />
              88% success rate
            </p>
          </div>
          <div className="w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center">
            <Icon name="CheckCircle" size={24} className="text-success" />
          </div>
        </div>
      </div>

      <div className="bg-card rounded-lg p-6 security-shadow">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm text-muted-foreground">Avg. Remediation Time</p>
            <p className="text-3xl font-bold text-card-foreground">14.2</p>
            <p className="text-sm text-muted-foreground mt-1">days</p>
          </div>
          <div className="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
            <Icon name="Clock" size={24} className="text-primary" />
          </div>
        </div>
      </div>

      {/* Severity Distribution Chart */}
      <div className="lg:col-span-2 bg-card rounded-lg p-6 security-shadow">
        <h3 className="text-lg font-semibold text-card-foreground mb-4">Severity Distribution</h3>
        <div className="h-64">
          <ResponsiveContainer width="100%" height="100%">
            <BarChart data={severityData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#E2E8F0" />
              <XAxis dataKey="name" stroke="#64748B" />
              <YAxis stroke="#64748B" />
              <Tooltip 
                contentStyle={{ 
                  backgroundColor: '#FFFFFF', 
                  border: '1px solid #E2E8F0',
                  borderRadius: '6px'
                }}
              />
              <Bar dataKey="count" fill="#0EA5E9" radius={[4, 4, 0, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Remediation Trends */}
      <div className="lg:col-span-2 bg-card rounded-lg p-6 security-shadow">
        <h3 className="text-lg font-semibold text-card-foreground mb-4">Remediation Trends</h3>
        <div className="h-64">
          <ResponsiveContainer width="100%" height="100%">
            <LineChart data={trendData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#E2E8F0" />
              <XAxis dataKey="month" stroke="#64748B" />
              <YAxis stroke="#64748B" />
              <Tooltip 
                contentStyle={{ 
                  backgroundColor: '#FFFFFF', 
                  border: '1px solid #E2E8F0',
                  borderRadius: '6px'
                }}
              />
              <Line 
                type="monotone" 
                dataKey="discovered" 
                stroke="#D97706" 
                strokeWidth={2}
                name="Discovered"
              />
              <Line 
                type="monotone" 
                dataKey="remediated" 
                stroke="#059669" 
                strokeWidth={2}
                name="Remediated"
              />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );
};

export default VulnerabilityMetrics;